<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Mark Attendance</title>
Â  Â Â 
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
Â  Â Â 
Â  Â  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  Â Â 
Â  Â  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

Â  Â  <style>
Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Global Reset & Setup
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  * {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  html, body {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #e0e5ec;
Â  Â  Â  Â  Â  Â  color: #1a202c;
Â  Â  Â  Â  Â  Â  line-height: 1.5;
Â  Â  Â  Â  Â  Â  -webkit-font-smoothing: antialiased;
Â  Â  Â  Â  }
Â  Â  Â  Â  .material-symbols-outlined {
Â  Â  Â  Â  Â  Â  font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
Â  Â  Â  Â  Â  Â  vertical-align: middle;
Â  Â  Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * App Layout
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .app-container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  }
Â  Â  Â  Â  .main-content {
Â  Â  Â  Â  Â  Â  flex-grow: 1;Â 
Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  Â  Â  padding: 24px 20px 180px 20px;Â 
Â  Â  Â  Â  Â  Â  scrollbar-width: none;Â 
Â  Â  Â  Â  Â  Â  -ms-overflow-style: none;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .main-content::-webkit-scrollbar { display: none; }

Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Header
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  header {
Â  Â  Â  Â  Â  Â  padding: 24px 20px 20px 20px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #f1f5f9;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-top {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 12px;
Â  Â  Â  Â  Â  Â  margin-bottom: 16px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-top .back-btn {
Â  Â  Â  Â  Â  Â  font-size: 28px;
Â  Â  Â  Â  Â  Â  font-variation-settings: 'wght' 500;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-top h1 {
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  line-height: 1.2;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-bottom {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  gap: 16px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  color: #475569;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-bottom .info-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 6px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-bottom .info-item .material-symbols-outlined {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Toggle Switch
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .toggle-switch {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  Â  Â  Â  background-color: #f1f5f9;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  padding: 4px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .toggle-btn {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 9px;
Â  Â  Â  Â  Â  Â  background-color: transparent;
Â  Â  Â  Â  Â  Â  color: #475569;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .toggle-btn.active {
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  color: #4f46e5;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
Â  Â  Â  Â  }
Â  Â  Â  Â  .toggle-btn .material-symbols-outlined {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-variation-settings: 'wght' 500;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .tab-content { display: none; }
Â  Â  Â  Â  .tab-content.active { display: block; }

Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Manual Entry: Search
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .search-bar {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .search-bar .icon {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  left: 14px;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  transform: translateY(-50%);
Â  Â  Â  Â  Â  Â  color: #94a3b8;
Â  Â  Â  Â  Â  Â  font-size: 22px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .search-bar input {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 12px 16px 12px 48px;
Â  Â  Â  Â  Â  Â  border: 1px solid #e2e8f0;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  color: #1a202c;
Â  Â  Â  Â  }
Â  Â  Â  Â  .search-bar input:focus {
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  Â  Â  border-color: #4f46e5;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Manual Entry: Student List
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .student-list {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 12px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .student-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 16px;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  border: 1px solid #f1f5f9;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 12px rgba(149, 157, 165, 0.05);
Â  Â  Â  Â  }
Â  Â  Â  Â  .student-item .student-name {
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  color: #1a202c;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Custom Checkbox */
Â  Â  Â  Â  .student-item input[type="checkbox"] {
Â  Â  Â  Â  Â  Â  appearance: none;
Â  Â  Â  Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  Â  Â  Â  width: 24px;
Â  Â  Â  Â  Â  Â  height: 24px;
Â  Â  Â  Â  Â  Â  background-color: #f1f5f9;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  border: 2px solid #e2e8f0;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .student-item input[type="checkbox"]:checked {
Â  Â  Â  Â  Â  Â  background-color: #4f46e5;
Â  Â  Â  Â  Â  Â  border-color: #4f46e5;
Â  Â  Â  Â  }
Â  Â  Â  Â  .student-item input[type="checkbox"]:checked::after {
Â  Â  Â  Â  Â  Â  content: '\e5ca';
Â  Â  Â  Â  Â  Â  font-family: 'Material Symbols Outlined';
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  Â  Â  font-style: normal;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  Â  Â  text-transform: none;
Â  Â  Â  Â  Â  Â  letter-spacing: normal;
Â  Â  Â  Â  Â  Â  word-wrap: normal;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  Â  Â  direction: ltr;
Â  Â  Â  Â  Â  Â  -webkit-font-smoothing: antialiased;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  font-variation-settings: 'wght' 700;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * QR Scanner Tab
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .qr-scanner-content {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 30px 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid #f1f5f9;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 24px rgba(149, 157, 165, 0.08);
Â  Â  Â  Â  }
Â  Â  Â  Â  .qr-scanner-content .qr-icon-wrapper {
Â  Â  Â  Â  Â  Â  width: 120px;
Â  Â  Â  Â  Â  Â  height: 120px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  background-color: #f8fafc;
Â  Â  Â  Â  Â  Â  border: 1px solid #e2e8f0;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .qr-scanner-content .qr-icon {
Â  Â  Â  Â  Â  Â  font-size: 80px;
Â  Â  Â  Â  Â  Â  color: #4f46e5;
Â  Â  Â  Â  }
Â  Â  Â  Â  .qr-scanner-content p {
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  color: #475569;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  }
Â  Â  Â  Â  .simulate-scan-btn { /* Renamed to "Open Scanner" in JS */
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 250px;
Â  Â  Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  background-color: #22c55e;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .simulate-scan-btn:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.98);
Â  Â  Â  Â  }
Â  Â  Â  Â  .qr-scanner-content .scanned-count {
Â  Â  Â  Â  Â  Â  margin-top: 16px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  color: #1a202c;
Â  Â  Â  Â  }


Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Fixed Submit Button
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .submit-footer {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  bottom: 80px;Â 
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  padding: 16px 20px;
Â  Â  Â  Â  Â  Â  background-image: linear-gradient(to top, #ffffff 70%, rgba(255,255,250,0));
Â  Â  Â  Â  Â  Â  z-index: 900;
Â  Â  Â  Â  }
Â  Â  Â  Â  .submit-btn {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 14px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  background-image: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â  .submit-btn:disabled {
Â  Â  Â  Â  Â  Â  background-image: none;
Â  Â  Â  Â  Â  Â  background-color: #cbd5e1;
Â  Â  Â  Â  Â  Â  cursor: wait;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Bottom Navigation
Â  Â  Â  Â  Â * ------------------- */
public-supply-gold-healthy-section-know.gif Â  Â  Â  Â  .bottom-nav {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  Â  Â  padding: 12px 0 10px 0;
Â  Â  Â  Â  Â  Â  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.06);
Â  Â  Â  Â  Â  Â  border-top: 1px solid #e2e8f0;
Â  Â  Â  Â  Â  Â  border-top-left-radius: 20px;
Â  Â  Â  Â  Â  Â  border-top-right-radius: 20px;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-item {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  _http: Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  color: #718096;Â 
Â  Â  Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-item .material-symbols-outlined {
Â  Â  Â  Â  Â  Â  font-size: 26px;
Â  Â  Â  Â  Â  Â  margin-bottom: 2px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-item.active { color: #4f46e5; }
Â  Â  Â  Â  .nav-item.active .material-symbols-outlined { font-variation-settings: 'FILL' 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Toast Notification
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .toast {
Â  Â  Â  Â  Â  Â  visibility: hidden;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  position: fixed;Â 
Â  Â  Â  Â  Â  Â  bottom: 100px;Â 
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  background-color: #333;
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  Â  Â  Â  border-radius: 25px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  z-index: 2000;Â 
Â  Â  Â  Â  Â  Â  transition: opacity 0.3s, visibility 0.3s, bottom 0.3s;
Â  Â  Â  Â  Â  Â  white-space: nowrap;
Â  Â  Â  Â  }
Â  Â  Â  Â  .toast.show {
Â  Â  Â  Â  Â  Â  visibility: visible;
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  Â  Â  bottom: 110px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * NEW: QR Scanner Modal
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  .scanner-modal {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  z-index: 5000;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  overflow: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .scanner-modal .scanner-backdrop {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.6);
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  Â  }
Â  Â  Â  Â  .scanner-modal .scanner-content {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  padding: 24px;
Â  Â  Â  Â  Â  Â  border-radius: 16px;
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .scanner-modal .scanner-header {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 16px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .scanner-modal .scanner-header h2 {
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }
Â  Â  Â  Â  .scanner-modal .scanner-close-btn {
Â  Â  Â  Â  Â  Â  font-size: 28px;
Â  Â  Â  Â  Â  Â  color: #718096;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â  #qr-reader {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  border: 1px solid #e2e8f0;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* -------------------
Â  Â  Â  Â  Â * Desktop Media Query
Â  Â  Â  Â  Â * ------------------- */
Â  Â  Â  Â  @media (min-width: 500px) {
Â  Â  Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  Â  Â  padding: 16px 0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .app-container {
Â  Â  Â  Â  Â  Â  Â  Â  max-width: 450px;
Â  Â  Â  Â  Â  Â  Â  Â  height: 95vh;
TA-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  max-height: 850px;
Â  Â  Â  Â  Â  Â  Â  Â  border-radius: 24px;
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
Â  Â  Â  Â  Â  Â  Â  Â  border: 1px solid #f8f9fa;
Â  Â  Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  Â  Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .bottom-nav {
Â  Â  Â  Â  Â  Â  Â  Â  border-bottom-left-radius: 24px;
Â  Â  Â  Â  Â  Â  Â  Â  border-bottom-right-radius: 24px;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .submit-footer {
Â  Â  Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  Â  Â  max-width: 450px;
Â  Â  Â  Â  Â  Â  Â  Â  bottom: 80px;
Â  Â  Â  Â  Â  Â  Â  Â  border-radius: 24px;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .toast, .scanner-modal {
Â  Â  Â  Â  Â  Â  Â  Â  position: absolute; /* Contain modal to app */
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <div class="app-container">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div class="header-top">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined back-btn">arrow_back</span>
Â  Â  Â  Â  Â  Â  Â  Â  <h1 id="lecture-subject">Loading...</h1>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="header-bottom">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">calendar_month</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="lecture-date">--/--/----</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">schedule</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="lecture-time">--:--</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <main class="main-content">

Â  Â  Â  Â  Â  Â  <div class="toggle-switch">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="toggle-btn active" id="btn-manual" data-tab="manual-entry">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">edit_note</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Manual Entry
Â  Â  Â  Â  Â  Â  Â  A-pa-b-ok-en.gif Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="toggle-btn" id="btn-qr" data-tab="qr-scanner">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">qr_code_scanner</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  QR Scanner
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="manual-entry" class="tab-content active">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="search-bar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined icon">search</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="search-input" placeholder="Search by name...">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="student-list" id="student-list-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="qr-scanner" class="tab-content">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="qr-scanner-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="qr-icon-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined qr-icon">qr_code_2</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Open the scanner to mark attendance</p>
S-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="simulate-scan-btn" id="open-scanner-btn">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Open Scanner
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Ind-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="scanned-count" id="scanned-count">Scanned: 0 students</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </main>

Â  Â  Â  Â  <div class="submit-footer" id="submit-footer">
Â  Â  Â  Â  Â  Â  <button class="submit-btn" id="submit-btn">Submit Attendance (0/0)</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <nav class="bottom-nav">
Â  Â  Â  Â  Â  Â  <a href="index.html" class="nav-item">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">home</span>
Â  Â  Â  Â  Â  Â  Â  Â  Home
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="record.html" class="nav-item active">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">playlist_add_check</span>
Â  Â  Â  Â  Â  Â  Â  Â  Record
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="students.html" class="nav-item">
TA-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">groups</span>
Â  Â  Â  Â  Â  Â  Â  Â  Students
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <a href="analytics.html" class="nav-item">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined">bar_chart</span>
Â  Â  Â  Â  Â  Â  Â  Â  Analytics
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </nav>

Â  Â  Â  Â  <div id="toast" class="toast">
Â  Â  Â  Â  Â  Â  <span id="toast-message">This is a toast message!</span>
Â  Â  Â  Â  </div>

Â  Â  </div>
Â  Â Â 
Â  Â  <div id="scanner-modal" class="scanner-modal">
Â  Â  Â  Â  <div class="scanner-backdrop"></div>
Â  Â  Â  Â  <div class="scanner-content">
Â  Â  Â  Â  Â  Â  <div class="scanner-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>Scan Student QR Code</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="material-symbols-outlined scanner-close-btn" id="scanner-close-btn">close</span>
Read-pa-b-ok-en.gif Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="qr-reader"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>


Â  Â  <script>
Â  Â  Â  Â  // --- 1. SUPABASE SETUP ---
Â  Â  Â  Â  const SUPABASE_URL = 'https://qbtxcpyjceemqdqipcdd.supabase.co';
Â  Â  Â  Â  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFidHhjcHlqY2VlbXFkcWlwY2RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0MjQ3ODYsImV4cCI6MjA3NzAwMDc4Nn0.xlYnj-EKqXcqFlYdx4Us1iEI2OoRV2IjtAyLIG6PVok';

Â  Â  Â  Â  const { createClient } = supabase;
Â  Â  Â  Â  const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

Â  Â  Â  Â  // --- 2. GLOBAL VARIABLES ---
Â  Â  Â  Â  let toastTimer;
Â  Â  Â  Â  let currentLecture = null;
Â  Â  Â  Â  let allStudents = [];
Â  Â  Â  Â  let attendanceRecords = new Map();
Â  Â  Â  Â  let currentLectureId = null;
Â  Â  Â  Â  let scannedStudentCount = 0;Â 
Â  Â  Â  Â  let html5QrCode = null; // <-- NEW: For scanner instance
Â  Â  Â  Â  let beepSound = null; // <-- NEW: For audio
Â  Â  Â  Â  let audioContext = null; // <-- NEW: Audio Context

Â  Â  Â  Â  // --- 3. DOM ELEMENTS ---
Â  Â  Â  Â  const toast = document.getElementById('toast');
Â  Â  Â  Â  const toastMessage = document.getElementById('toast-message');
Â  Â  Â  Â  const studentListContainer = document.getElementById('student-list-container');
Â  Â  Â  Â  const searchInput = document.getElementById('search-input');
Â  Â  Â  Â  const submitBtn = document.getElementById('submit-btn');
Â  Â  Â  Â  const manualTab = document.getElementById('manual-entry');
Â  Â  Â  Â  const qrTab = document.getElementById('qr-scanner');
Â  Â  Â  Â  const btnManual = document.getElementById('btn-manual');
Â  Â  Â  Â  const btnQr = document.getElementById('btn-qr');
Â  Â  Â  Â  const submitFooter = document.getElementById('submit-footer');
Â  Â  Â  Â  const openScannerBtn = document.getElementById('open-scanner-btn'); // <-- RENAMED
Â  Â  Â  Â  const scannedCountLabel = document.getElementById('scanned-count');Â 
Â  Â  Â  Â  // --- NEW: Modal Elements ---
Â  Â  Â  Â  const scannerModal = document.getElementById('scanner-modal');
Â  Â  Â  Â  const scannerCloseBtn = document.getElementById('scanner-close-btn');
Â  Â  Â  Â  const qrReaderDiv = document.getElementById('qr-reader');

Â  Â  Â  Â  // --- 4. CORE FUNCTIONS ---

Â  Â  Â  Â  function showToast(message, isError = false) {
Â  Â  Â  Â  Â  Â  // --- MODIFICATION START ---
Â  Â  Â  Â  Â  Â  // Do not show toast if scanner modal is active
Â  Â  Â  Â  Â  Â  if (scannerModal.style.display === 'block') {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(`[Toast Suppressed]: ${message}`);
Â  Â  Â  Â  Â  Â  Â  Â  return; 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // --- MODIFICATION END ---
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (toastTimer) clearTimeout(toastTimer);
Â  Â  Â  Â  Â  Â  toastMessage.textContent = message;
Â  Â  Â  Â  Â  Â  toast.style.backgroundColor = isError ? '#e53e3e' : '#333';
Â  Â  Â  Â  Â  Â  toast.classList.add('show');
Â  Â  Â  Â  Â  Â  toastTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  toast.classList.remove('show');
Â  Â  Â  Â  Â  Â  Â  Â  toastTimer = null;
Â  Â  Â  Â  Â  Â  }, 3000);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Formatting Helpers ---
Â  Â  Â  Â  function formatTime(timeString) {
Â  Â  Â  Â  Â  Â  if (!timeString) return 'N/A';
Â  Â  Â  Â  Â  Â  const [hours, minutes] = timeString.split(':');
Â  Â  Â  Â  Â  Â  const d = new Date();
Â  Â  Â  Â  Â  Â  d.setHours(parseInt(hours));
Â  Â  Â  Â  Â  Â  d.setMinutes(parseInt(minutes));
Â  Â  Â  Â  Â  Â  return d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
Â  Â  Â  Â  }
Â  Â  Â  Â  Â function formatDate(dateString) {
Â  Â  Â  Â  Â  Â  Â if (!dateString) return 'N/A';
Â  Â  Â  Â  Â  Â  Â const [year, month, day] = dateString.split('-');
Â  Â  Â  Â  Â  Â  Â return `${day}/${month}/${year}`;
Â  Â  Â  Â  Â }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Loads all necessary data on page load
Â  Â  Â  Â  Â */
Â  Â  Â  Â  async function loadPageData() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const params = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  Â  Â  Â  currentLectureId = params.get('lecture_id');
Â  Â  Â  Â  Â  Â  Â  Â  if (!currentLectureId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('No lecture ID found!', true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const { data: lecture, error: lectureError } = await _supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('lectures')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('*')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('lecture_id', currentLectureId)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .single();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (lectureError) throw new Error('Could not fetch lecture details.');
Â  Â  Â  Â  Â  Â  Â  Â  currentLecture = lecture;
Â  Â  Â  Â  Â  Â  Â  Â  updateHeader(lecture);

Â  Â  Â  Â  Â  Â  Â  Â  const { data: students, error: studentError } = await _supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('students')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('student_id, name')Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('course', lecture.course)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .order('name', { ascending: true });

Â  Â  Â  Â  Â  Â  Â  Â  if (studentError) throw new Error('Could not fetch students.');
Â  Â  Â  Â  Â  Â  Â  Â  allStudents = students;

Â  Â  Â  Â  Â  Â  Â  Â  const { data: records, error: recordError } = await _supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('attendance_records')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .select('student_id, status')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('lecture_id', currentLectureId)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .eq('type', 'lecture');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (recordError) throw new Error('Could not fetch attendance records.');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  attendanceRecords = new Map(records.map(r => [r.student_id, r.status]));

ind-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  renderStudentList();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error loading page data:', error.message);
Â  Â  Â  Â  Â  Â  Â  Â  showToast(error.message, true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateHeader(lecture) {
Â  Â  Â  Â  Â  Â  document.getElementById('lecture-subject').textContent = lecture.subject_name;
Â  Â  Â  Â  Â  Â  document.getElementById('lecture-date').textContent = formatDate(lecture.date);
Â  Â  Â  Â  Â  Â  document.getElementById('lecture-time').textContent =Â 
Â  Â  Â  Â  Â  Â  Â  Â  `${formatTime(lecture.start_time)} - ${formatTime(lecture.end_time)}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderStudentList() {
Â  Â  Â  Â  Â  Â  studentListContainer.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (allStudents.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  studentListContainer.innerHTML = '<p style="text-align:center; color: #718096;">No students found for this course.</p>';
is-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  allStudents.forEach(student => {
Â  Â  Â  Â  Â  Â  Â  Â  const isPresent = attendanceRecords.get(student.student_id) === true;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'student-item';
Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="student-name">${student.name}</span>
Read-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="attendance-checkbox"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â data-student-id="${student.student_id}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â ${isPresent ? 'checked' : ''}>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  studentListContainer.appendChild(item);
is-pa-b-ok-en.gif Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updateSubmitButtonCount();Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateSubmitButtonCount() {
Â  Â  Â  Â  Â  Â  const totalStudents = allStudents.length;
Â  Â  Â  Â  Â  Â  const presentStudents = studentListContainer.querySelectorAll('.attendance-checkbox:checked').length;
Â  Â  Â  Â  Â  Â  submitBtn.textContent = `Submit Attendance (${presentStudents}/${totalStudents})`;
Â  Â  Â  Â  }

Â  Â  Â  Â  async function handleSubmitAttendance() {
Â  Â  Â  Â  Â  Â  submitBtn.disabled = true;
Â  Â  Â  Â  Â  Â  submitBtn.textContent = 'Submitting...';

Â  Â  Â  Â  Â  Â  const checkboxes = studentListContainer.querySelectorAll('.attendance-checkbox');
Â  Â  Â  Â  Â  Â  const recordsToUpsert = [];
Â  Â  Â  Â  Â  Â  const now = new Date().toISOString();

Â  Â  Â  Â  Â  Â  checkboxes.forEach(cb => {
Â  Â  Â  Â  Â  Â  Â  Â  recordsToUpsert.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  student_id: parseInt(cb.dataset.studentId),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lecture_id: parseInt(currentLectureId),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'lecture',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: cb.checked,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marked_at: now
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const { error } = await _supabase
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .from('attendance_records')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .upsert(recordsToUpsert, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onConflict: 'student_id, lecture_id, type'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (error) throw error;

Â  Â  Â  Â  Â  Â  Â  Â  showToast('Attendance submitted successfully! ðŸŽ‰');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  recordsToUpsert.forEach(r => attendanceRecords.set(r.student_id, r.status));

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error submitting attendance:', error.message);
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Error: ${error.message}`, true);
Â  _http: Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  submitBtn.disabled = false;
A-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  updateSubmitButtonCount();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function filterStudentList() {
Â  Â  Â  Â  Â  Â  const searchTerm = searchInput.value.toLowerCase();
Â  Â  Â  Â  Â  Â  const students = studentListContainer.querySelectorAll('.student-item');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  students.forEach(student => {
Â  Â  Â  Â  Â  Â  Â  Â  const name = student.querySelector('.student-name').textContent.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  if (name.includes(searchTerm)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  student.style.display = 'flex';
s-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  student.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function switchTab(tabName) {
Â  Â  Â  Â  Â  Â  if (tabName === 'manual-entry') {
Â  Â  Â  Â  Â  Â  Â  Â  manualTab.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  qrTab.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  btnManual.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  btnQr.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  submitFooter.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  } else if (tabName === 'qr-scanner') {
Â  Â  Â  Â  Â  Â  Â  Â  manualTab.classList.remove('active');
TA-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  qrTab.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  btnManual.classList.remove('active');
Â  Â  Â  Â  Â  Â  Â  Â  btnQr.classList.add('active');
A-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  submitFooter.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  scannedStudentCount = 0;
Â  Â  Â  Â  Â  Â  Â  Â  scannedCountLabel.textContent = `Scanned: 0 students`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * NEW: Marks a student as present from a scan or simulation
S-pa-b-ok-en.gif Â  Â  Â  Â  Â */
Â  Â  Â  Â  function markStudentPresent(studentId) {
Â  Â  Â  Â  Â  Â  const student = allStudents.find(s => s.student_id === studentId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!student) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Student ID ${studentId} not found in this class.`, true);
Â  Â  Â  Â  Â  Â  Â  Â  return false; // Indicate failure
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const checkbox = document.querySelector(`.attendance-checkbox[data-student-id="${studentId}"]`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!checkbox) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`UI Error: Could not find checkbox for ${student.name}`, true);
Â  Â  Â  Â  Â  Â  Â  Â  return false; // Indicate failure
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (checkbox.checked) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`${student.name} already marked present.`);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  checkbox.checked = true;
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Scanned: ${student.name} âœ…`);
Â  Â  Â  Â  Â  Â  Â  Â  updateSubmitButtonCount(); // Update the main submit button
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return true; // Indicate success
Read-pa-b-ok-en.gif Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * NEW: QR Scan Success Callback
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function onScanSuccess(decodedText, decodedResult) {
Â  Â  Â  Â  Â  Â  const studentId = parseInt(decodedText);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isNaN(studentId)) {
Â  Â  Â  Â  Â  Â  Â  Â  // Ignore scans that aren't numbers
Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`Scanned non-numeric QR: ${decodedText}`);
Â  Â  Â  Â  Â  Â  Â  Â  showToast(`Invalid QR. Please scan a valid student ID.`, true);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Mark the student and play beep if successful
is-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  const success = markStudentPresent(studentId);
Â  Â  Â  Â  Â  Â  if (success) {
Â  Â  Â  Â  Â  Â  Â  Â  beepSound.play();
SA-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  // Update the counter on the QR tab
Â  Â  Â  Â  Â  Â  Â  Â  scannedStudentCount++;
Â  Â  Â  Â  Â  Â  Â  Â  scannedCountLabel.textContent = `Scanned: ${scannedStudentCount} students`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * NEW: QR Scan Failure Callback
Â  TA-pa-b-ok-en.gif Â  Â  Â  Â  Â */
Â  Â  Â  Â  function onScanFailure(error) {
Read-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  // This will fire constantly, so we'll just log warnings
Â  Â  Â  Â  Â  Â  // console.warn(`QR scan error: ${error}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * NEW: Stops the camera and hides the modal
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function closeScanner() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (html5QrCode && html5QrCode.isScanning) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html5QrCode.stop();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (err) {
A-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error stopping scanner: ", err);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  scannerModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  // Switch back to manual tab so user can see their changes
Â  Â  Â  ci-pa-b-ok-en.gif Â  Â  Â  switchTab('manual-entry');
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- 5. EVENT LISTENERS ---

Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  loadPageData();

Â  Â  Â  Â  Â  Â  // --- NEW: Initialize Scanner & Beep ---
Â  Â  Â  Â  Â  Â  html5QrCode = new Html5Qrcode("qr-reader");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create a simple beep sound
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  audioContext = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // --- MODIFICATION START ---
Â  Â  Â  Â  Â  Â  Â  Â  beepSound = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  play: () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!audioContext) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const oscillator = audioContext.createOscillator();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const gainNode = audioContext.createGain();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oscillator.connect(gainNode);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gainNode.connect(audioContext.destination);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oscillator.type = 'triangle'; // Softer sound
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oscillator.frequency.setValueAtTime(1200, audioContext.currentTime); // Higher pitch
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Short 50ms beep with fade-out
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);

S-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oscillator.start(audioContext.currentTime);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oscillator.stop(audioContext.currentTime + 0.05);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  // --- MODIFICATION END ---
s-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Web Audio API is not supported in this browser");
Â  Â  Â  Â  Â  Â  Â  Â  // Create a dummy beepSound object so the app doesn't crash
Â  Â  Â  Â  Â  Â  Â  Â  beepSound = { play: () => {} }; 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  document.querySelector('.back-btn').addEventListener('click', () => {
S-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  window.history.back();Â 
Â  Â  Â  Â  });

Â  Â  Â  Â  // Tab switching
Â  Â  Â  Â  btnManual.addEventListener('click', () => switchTab('manual-entry'));
Â  Â  Â  Â  btnQr.addEventListener('click', () => switchTab('qr-scanner'));

Â  Â  Â  Â  // Search bar
Â  Â  Â  Â  searchInput.addEventListener('input', filterStudentList);

Â  Â  Â  Â  // Listen for checkbox changes to update count
Â  Â  Â  Â  studentListContainer.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('attendance-checkbox')) {
Â  Â  Â  Â  Â  Â  Â  Â  updateSubmitButtonCount();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Submit button
Â  Â  Â  Â  submitBtn.addEventListener('click', handleSubmitAttendance);

Â  Â  Â  Â  // --- NEW: Scanner Modal Listeners ---
Â  Â  Â  Â  openScannerBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  // Attempt to create AudioContext on user interaction if it failed to load
Â  Â  Â  Â  Â  Â  if (!audioContext) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audioContext = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Could not create AudioContext on click");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  scannerModal.style.display = 'block';
Read-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â Â 
Â  Â  A-pa-b-ok-en.gif Â  Â  Â  Â  // Start the scanner
Â  Â  Â  Â  Â  Â  const config = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  fps: 10,Â 
Â  Â  Â  Â  Â  Â  Â  Â  qrbox: { width: 250, height: 250 }IA-pa-b-ok-en.gif Â 
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  html5QrCode.start(
Â  Â  Â  Â  Â  Â  Â  Â  { facingMode: "environment" }, // Use rear camera
Â  Â  Â  Â  Â  Â  Â  Â  config,
Â  Â  Â  Â  Â  Â  Â  Â  onScanSuccess,
s-pa-b-ok-en.gif Â  Â  Â  Â  Â  Â  Â  Â  onScanFailure
Â  Â  Â  Â  Â  Â  ).catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('Error starting camera. Please grant permission.', true);
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error starting camera: ", err);
Â  Â  Â  Â  Â  Â  Â  Â  scannerModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  scannerCloseBtn.addEventListener('click', closeScanner);
Â  Â  Â  Â  scannerModal.querySelector('.scanner-backdrop').addEventListener('click', closeScanner);

Â  Â  </script>

</body>
</html>
